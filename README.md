# Homework Helper Bot

Telegram-–±–æ—Ç –¥–ª—è –ø–æ–º–æ—â–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º British Management University (BMU) –≤ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–µ —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π (–î–ó). –ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —Ü–µ–Ω—É —Å –ø–æ–º–æ—â—å—é –ò–ò (Gemini), –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏ (–Ω–∞ —Å—Ç–∞—Ä—Ç–µ ‚Äî —Ä—É—á–Ω—ã–µ), –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ—à–µ–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã.

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- **–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è**: –°—Ç—É–¥–µ–Ω—Ç—ã BMU, 18‚Äì25 –ª–µ—Ç.
- **–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**: –ü—Ä–∏–µ–º –î–ó (—Ç–µ–∫—Å—Ç/—Ñ–∞–π–ª—ã/—Ñ–æ—Ç–æ), –ò–ò-–æ—Ü–µ–Ω–∫–∞, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –æ–ø–ª–∞—Ç–∞ (—Ç–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞), —Ä—É—á–Ω–∞—è/–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏–π, —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.
- **–≠—Ç–∞–ø—ã**: –†—É—á–Ω–æ–π MVP (–≠—Ç–∞–ø 1) ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å n8n (–≠—Ç–∞–ø 2) ‚Üí –ú–∞—Å—à—Ç–∞–± —Å –¥–∞—à–±–æ—Ä–¥–æ–º (–§–∞–∑–∞ 3).
- **–Ø–∑—ã–∫**: –†—É—Å—Å–∫–∏–π (—Å –æ–ø—Ü–∏–µ–π –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –≤ –±—É–¥—É—â–µ–º).

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –¢–ó: [–°—Å—ã–ª–∫–∞ –Ω–∞ –¢–ó, –µ—Å–ª–∏ –µ—Å—Ç—å].

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **–ë—ç–∫–µ–Ω–¥**: Python 3.12 + python-telegram-bot v20+.
- **–ë–î**: SQLite (homework_bot.db).
- **–ò–ò**: Google Gemini API (gemini-1.5-flash).
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤**: python-docx + reportlab.
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: n8n (self-host).
- **–î–µ–ø–ª–æ–π**: Heroku (–±–æ—Ç), Render.com (n8n).
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: Git/GitHub.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ)

1. **–ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:
   ```
   git clone https://github.com/your-username/homework-helper-bot.git
   cd homework-helper-bot
   ```

2. **–°–æ–∑–¥–∞–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   ```
   python -m venv venv
   source venv/bin/activate  # –ù–∞ Windows: venv\Scripts\activate
   ```

3. **–£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   ```
   pip install -r requirements.txt
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π —Å–µ–∫—Ä–µ—Ç—ã**:
   - –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–¥–æ–±–∞–≤—å –≤ `.gitignore`):
     ```
     TOKEN=your_telegram_bot_token  # –û—Ç @BotFather
     GEMINI_KEY=your_gemini_api_key  # –û—Ç ai.google.dev
     ADMIN_ID=your_telegram_user_id  # –¢–≤–æ–π ID –∫–∞–∫ –∞–¥–º–∏–Ω
     N8N_WEBHOOK_URL=https://your-n8n.onrender.com/webhook/  # –î–ª—è –≠—Ç–∞–ø–∞ 2
     ```
   - –ü–æ–ª—É—á–∏ –∫–ª—é—á–∏:
     - Telegram: @BotFather ‚Üí /newbot.
     - Gemini: ai.google.dev ‚Üí API keys (free tier).

5. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π –ë–î**:
   ```
   python init_db.py
   ```
   –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç `homework_bot.db` —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏: users, orders, logs.

6. **–ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞** (–¥–ª—è —Ç–µ—Å—Ç–∞ ‚Äî polling):
   ```
   python bot.py
   ```
   - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: –£—Å—Ç–∞–Ω–æ–≤–∏ webhook –≤ bot.py (—Å–º. –¢–ó 8.2).

7. **–ù–∞—Å—Ç—Ä–æ–π n8n (–¥–ª—è –≠—Ç–∞–ø–∞ 2)**:
   - –õ–æ–∫–∞–ª—å–Ω–æ: `docker run -it --rm --name n8n -p 5678:5678 -v ~/.n8n:/home/node/.n8n n8nio/n8n`.
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π workflow JSON (–ø—Ä–∏–º–µ—Ä –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ n8n community).
   - –î–µ–ø–ª–æ–π: Render.com (—Å–º. –¢–ó 8.3).

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**:
  - `/start` ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–≤–≤–µ–¥–∏—Ç–µ –∏–º—è).
  - `/dz` ‚Äî –û—Ç–ø—Ä–∞–≤—å—Ç–µ –î–ó (—Ç–µ–∫—Å—Ç, —Ñ–∞–π–ª PDF/DOCX/TXT, —Ñ–æ—Ç–æ –¥–ª—è OCR).
  - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ—Ü–µ–Ω–∫—É (–∫–Ω–æ–ø–∫–∏ –î–∞/–ù–µ—Ç), –æ–ø–ª–∞—Ç–∏—Ç–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É: 4557 4304 0205 3431 (Uzcard).
  - `/my_orders` ‚Äî –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.
- **–ê–¥–º–∏–Ω** (—Ç–æ–ª—å–∫–æ ADMIN_ID):
  - `/admin_confirm {order_id}` ‚Äî –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É.
  - `/send_dz {order_id}` ‚Äî –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ—Ç–æ–≤–æ–µ –î–ó (—Ä—É—á–Ω–æ–µ).
  - `/stats` ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∑–∞–∫–∞–∑—ã, –¥–æ—Ö–æ–¥, –æ—Ç–∑—ã–≤—ã).
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî webhook –≤ n8n –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DOCX/PDF.

## –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è Gemini
- **–ê–Ω–∞–ª–∏–∑ –î–ó** (—Ñ—É–Ω–∫—Ü–∏—è `analyze_dz`):
  ```
  –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –î–ó: {content}. –û—Ü–µ–Ω–∏: complexity (low/medium/high), deadline (12-24—á, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 18—á), price (20000-100000 UZS). –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ JSON: {"complexity": "...", "deadline": "...", "price": 50000}.
  ```
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è** (–≤ n8n):
  ```
  –ò—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω [—Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∏–º–µ—Ä –î–ó –≤ Google Drive]. –†–µ—à–∏ –∑–∞–¥–∞–Ω–∏–µ: {dz_content}. –§–æ—Ä–º–∞—Ç: –¢–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç (British Management University, —Å—Ç—É–¥–µ–Ω—Ç: {user_name}, –¥–∞—Ç–∞: {current_date}), —Ä–∞–∑–¥–µ–ª "–†–µ—à–µ–Ω–∏–µ" —Å —à–∞–≥–∞–º–∏, "–ò—Å—Ç–æ—á–Ω–∏–∫–∏" –≤ –∫–æ–Ω—Ü–µ. –í–µ—Ä–Ω–∏ —Ç–µ–∫—Å—Ç –¥–ª—è DOCX.
  ```
- **OCR –¥–ª—è —Ñ–æ—Ç–æ**:
  ```
  –ò–∑–≤–ª–µ–∫–∏ —Ç–µ–∫—Å—Ç –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: [image_description]. –í–µ—Ä–Ω–∏ —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –î–ó.
  ```

## –°—Ö–µ–º–∞ –ë–î (SQLite: homework_bot.db)
–°–æ–∑–¥–∞–Ω–∞ –≤ `init_db.py`. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –≤ DB Browser for SQLite –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_active TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    dz_file_path TEXT,  -- –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –î–ó (/files/{user_id}_{timestamp}.*)
    dz_content TEXT,    -- –¢–µ–∫—Å—Ç/OCR –∏–∑ —Ñ–∞–π–ª–∞
    complexity TEXT,    -- 'low'/'medium'/'high'
    deadline TEXT,      -- '18—á'
    price INTEGER,      -- UZS
    status TEXT DEFAULT 'new',  -- 'new', 'waiting_payment', 'accepted', 'completed', 'cancelled', 'rejected'
    payment_status TEXT DEFAULT 'pending',  -- 'pending', 'paid', 'failed'
    order_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,
    review_score INTEGER,  -- 1-5
    FOREIGN KEY (user_id) REFERENCES users (user_id)
);

-- –¢–∞–±–ª–∏—Ü–∞ –ª–æ–≥–æ–≤
CREATE TABLE logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id INTEGER,
    event TEXT,  -- 'dz_received', 'payment_confirmed', etc.
    details TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders (id)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_orders_user ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
```

**–û–ø–µ—Ä–∞—Ü–∏–∏**:
- –í—Å—Ç–∞–≤–∫–∞: `INSERT INTO users (user_id, name) VALUES (?, ?);`
- –ó–∞–ø—Ä–æ—Å—ã: `SELECT * FROM orders WHERE user_id = ? AND status != 'completed';`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è: `UPDATE orders SET status = 'accepted' WHERE id = ?;`

## –î–µ–ø–ª–æ–π
- **Heroku** (–±–æ—Ç):
  ```
  heroku create homework-helper-bot
  git push heroku main
  heroku ps:scale worker=1
  heroku config:set WEBHOOK_URL=https://your-app.herokuapp.com/
  ```
- **n8n –Ω–∞ Render**: Connect GitHub ‚Üí Web Service ‚Üí Docker (n8nio/n8n) ‚Üí Set vars (N8N_BASIC_AUTH_ACTIVE=true).
- **–ë—ç–∫–∞–ø**: n8n cron –¥–ª—è dump –ë–î –≤ Google Drive.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Unit-—Ç–µ—Å—Ç—ã: `pytest` (—Ç–µ—Å—Ç—ã –≤ `tests/`).
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ: –°–∏–º—É–ª–∏—Ä—É–π—Ç–µ —Ñ–ª–æ—É –≤ Telegram (—Ç–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã).
- Load-test: 10 concurrent users.

## –†–∏—Å–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- **–õ–∏–º–∏—Ç Gemini**: 25 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å ‚Äî fallback –Ω–∞ —Ä—É—á–Ω—É—é –æ—Ü–µ–Ω–∫—É (queue –≤ bot.py).
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è (user_id –≤ –ª–æ–≥–∞—Ö), —Ç–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞.
- **–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ**: –í /start –¥–æ–±–∞–≤—å—Ç–µ: "–≠—Ç–æ –ø–æ–º–æ—â—å –≤ –æ–±—É—á–µ–Ω–∏–∏, –Ω–µ –∑–∞–º–µ–Ω–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ."
- **–£–ª—É—á—à–µ–Ω–∏—è**: A/B-—Ç–µ—Å—Ç —Ü–µ–Ω, –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL –ø—Ä–∏ >100 –∑–∞–∫–∞–∑–æ–≤/–º–µ—Å.

## –ö–æ–Ω—Ç–∞–∫—Ç—ã
–ó–∞ –≤–æ–ø—Ä–æ—Å—ã ‚Äî @your_telegram. –û–±—â–∏–π —Å—Ä–æ–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: 7‚Äì12 –¥–Ω–µ–π. –ë—é–¥–∂–µ—Ç: 0 UZS. üöÄ

*–í–µ—Ä—Å–∏—è: 1.0 (MVP, 03.10.2025)*